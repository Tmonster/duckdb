# name: test/sql/sample/table_sample_converts_to_block_sample.test
# description: Test sampling of larger relations
# group: [sample]

require vector_size 2048

# table samples first collect only 1% of the table, until the table has a cardinality of 2048.
# then the sample stays at a fixed 2048 values.

statement ok
create table materialized_range as select 1 a from range(50000);

# only 2.048% of 10000
query I
select count(*) from pragma_table_sample('materialized_range');
----
1024


statement ok
insert into materialized_range select 2 a from range(50000);

# collect another 2.048% of 50000
query I
select count(*) from pragma_table_sample('materialized_range');
----
2048

query I
select a, count(*) from pragma_table_sample('materialized_range') group by all order by a;
----
1   1062
2   986


# insert another
statement ok
insert into materialized_range select 3 a from range(50000);

# sample remains at 2048 values
query I
select count(*) from pragma_table_sample('materialized_range');
----
2048


query I
select a, count(*) from pragma_table_sample('materialized_range') group by all order by a;
----
1   731
2   656
3   661

# name: test/optimizer/appian_issue.test
# description: Arithmetic simplification test
# group: [optimizer]

statement ok
attach 'appian.duckdb' as appian;

statement ok
use appian;

statement ok
WITH CTE AS (
  SELECT J1P, CUSTOMER_PRIORITY, CUSTOMER_ID FROM CUSTOMERVIEW
  LEFT JOIN (
    SELECT ORDER_CUSTOMERID, SUM(ORDERITEMVIEW.ORDERITEM_QUANTITY) AS J1P FROM ORDERVIEW
    LEFT JOIN ORDERITEMVIEW ON (ORDERVIEW.ORDER_ID = ORDERITEMVIEW.ORDERITEM_ORDERID)
    WHERE (ORDERVIEW.ORDER_ISEXPEDITEDSHIPPED IS TRUE)
    GROUP BY ORDERVIEW.ORDER_CUSTOMERID
  ) AS J1J ON (J1J.ORDER_CUSTOMERID = CUSTOMERVIEW.CUSTOMER_ID)
  ORDER BY CUSTOMER_PRIORITY ASC
  LIMIT 50 OFFSET 50
) SELECT J1P, Q2P, Q3P FROM CTE
LEFT JOIN (
  SELECT ORDER_CUSTOMERID FROM ORDERVIEW
) AS Q1J ON (Q1J.ORDER_CUSTOMERID = CTE.CUSTOMER_ID)
LEFT JOIN (
  SELECT CREDITCARD_CUSTOMERID AS Q2P FROM CREDITCARDVIEW
) AS Q2J ON (Q2J.Q2P = CTE.CUSTOMER_ID)
LEFT JOIN (
  SELECT ORDER_CUSTOMERID Q3P FROM ORDERVIEW
  LEFT JOIN ORDERITEMVIEW ON ORDERVIEW.ORDER_ID = ORDERITEM_ORDERID
) AS Q3J ON (Q3J.Q3P = CTE.CUSTOMER_ID);
